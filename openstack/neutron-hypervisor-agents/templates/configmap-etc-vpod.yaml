apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-etc-vpod
  labels:
    system: openstack
    type: configuration
    component: neutron
data:
  segment-names.yaml: |
    {{- range $v := .Values.aci.aci_hostgroups.hostgroups }}
    {{ $v.name }}: {{ toJson $v.hosts }}
    {{- end }}
  {{- $vpods_conf := default (dict) .Values.vpods_conf }}
  vpod.conf: |
    [DEFAULT]
    transport_url = rabbit://{{ default "" .Values.global.user_suffix | print .Values.rabbitmq.users.default.user }}:{{ .Values.rabbitmq.users.default.password | urlquery }}@neutron-rabbitmq:5672/
    {{- include "util.helpers.valuesToIni" $vpods_conf | nindent 4 }}
