{{ $envAll := . }}
{{- $cells := list "cell1" }}
{{- if .Values.cell2.enabled }}
  {{ $cells = append $cells .Values.cell2.name }}
{{- end }}
{{- range $cell_name := $cells }}
{{- with $envAll }}
---
apiVersion: v1
kind: Secret
metadata:
  name: nova-console-{{ $cell_name }}-mks
  labels:
    system: openstack
    type: nova-console
    component: nova
type: Opaque
data:
  config.lua: {{ include "nova.etc_config_lua" . | b64enc }}
{{- end }}
{{- end }}
