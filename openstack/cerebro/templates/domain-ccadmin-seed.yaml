apiVersion: "openstack.stable.sap.cc/v1"
kind: "OpenstackSeed"
metadata:
  name: cerebro-seed
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
spec:
  requires:
  - monsoon3/domain-ccadmin-seed

  domains:
  - name: ccadmin
    description: 'Converged Cloud Administration'
    projects:
    - name: cerebro
      description: 'Cerebro project for CC. This project was automatically generated by a project seed: https://github.com/sapcc/helm-charts/tree/master/openstack/cerebro/'
      networks:
      - name: default
        subnets:
        - name: cerebro_private
          cidr: 10.180.0.0/16
          ip_version: 4
      routers:
      - name: default
        external_gateway_info:
          network: FloatingIP-external-ccadmin@ccadmin-net-infra@ccadmin
          external_fixed_ips:
          - subnet: {{ .Values.routerExternalSubnet | default "FloatingIP-sap-ccadmin-01@ccadmin-net-infra@ccadmin" }}
        interfaces:
        - subnet: cerebro_private
      dns_zones:
        - name: "cca-pro.cerebro.c.{{ .Values.global.region }}.cloud.sap."
          email: {{ .Values.dnsZoneEmail }}
          type: PRIMARY
          ttl: 7200
          description: Cerebro productive domain.
          # recordsets:
          #   - name: cca-pro.cerebro.c.{{ .Values.global.region }}.cloud.sap.
          #     type: SOA
          #   - name: cca-pro.cerebro.c.{{ .Values.global.region }}.cloud.sap.
          #     type: NS
        - name: "cca-sta.cerebro.c.{{ .Values.global.region }}.cloud.sap."
          email: {{ .Values.dnsZoneEmail }}
          type: PRIMARY
          ttl: 7200
          description: Cerebro Staging domain.
        {{- if eq .Values.global.region "eu-de-1" }}
        - name: "cca-jen.cerebro.c.{{ .Values.global.region }}.cloud.sap."
          email: {{ .Values.dnsZoneEmail }}
          type: PRIMARY
          ttl: 7200
          description: Cerebro Jenkins domain.
        {{- end }}
      role_assignments:
      - user: {{ .Values.technicalUserPerRegion }}
        role: compute_viewer
      - user: {{ .Values.technicalUserPerRegion }}
        role: dns_webmaster
      - user: {{ .Values.technicalUserPerRegion }}
        role: kubernetes_admin
      - user: {{ .Values.technicalUserPerRegion }}
        role: member
      - user: {{ .Values.technicalUserPerRegion }}
        role: monitoring_viewer
      - user: {{ .Values.technicalUserPerRegion }}
        role: network_viewer
      - user: {{ .Values.technicalUserPerRegion }}
        role: registry_admin
      - user: {{ .Values.technicalUserPerRegion }}
        role: resource_viewer
      - user: {{ .Values.technicalUserPerRegion }}
        role: securitygroup_admin
      - user: {{ .Values.technicalUserPerRegion }}
        role: sharedfilesystem_viewer
      - user: {{ .Values.technicalUserPerRegion }}
        role: volume_viewer
    groups:
    - name: CCADMIN_CEREBRO_ADMIN
      role_assignments:
      - project: cerebro
        role: admin
      - project: cerebro
        role: audit_viewer
      - project: cerebro
        role: automation_admin
      - project: cerebro
        role: compute_admin
      - project: cerebro
        role: dns_zonemaster
      - project: cerebro
        role: image_admin
      - project: cerebro
        role: keymanager_admin
      - project: cerebro
        role: kubernetes_admin
      - project: cerebro
        role: masterdata_admin
      - project: cerebro
        role: member
      - project: cerebro
        role: monitoring_viewer
      - project: cerebro
        role: network_admin
      - project: cerebro
        role: registry_admin
      - project: cerebro
        role: resource_admin
      - project: cerebro
        role: role_admin
      - project: cerebro
        role: securitygroup_admin
      - project: cerebro
        role: sharedfilesystem_admin
      - project: cerebro
        role: objectstore_admin 
      - project: cerebro
        role: volume_admin
    - name: CCADMIN_CEREBRO_VIEWER
      role_assignments:
      - project: cerebro
        role: audit_viewer
      - project: cerebro
        role: automation_viewer
      - project: cerebro
        role: compute_viewer
      - project: cerebro
        role: dns_viewer
      - project: cerebro
        role: image_viewer
      - project: cerebro
        role: keymanager_viewer
      - project: cerebro
        role: kubernetes_member
      - project: cerebro
        role: masterdata_viewer
      - project: cerebro
        role: member
      - project: cerebro
        role: monitoring_viewer
      - project: cerebro
        role: network_viewer
      - project: cerebro
        role: registry_viewer
      - project: cerebro
        role: resource_viewer
      - project: cerebro
        role: role_viewer
      - project: cerebro
        role: sharedfilesystem_viewer
      - project: cerebro
        role: securitygroup_viewer
      - project: cerebro
        role: volume_viewer
