{{- $regions := .Values.regions }}
{{- if not $regions }}
{{- $regions = list .Values.global.region }}
{{- end }}

{{- range $regionName, $region := .Values.regions }}
{{- if ne $.Release.Namespace "garden" }}
---
apiVersion: v1
kind: Secret
metadata:
  name: openstack-{{ $regionName }}
type: Opaque
stringData:
  domainName: ccadmin
  tenantName: cc-gardener
  applicationCredentialID: "vault+kvv2:///secrets/{{ $regionName }}/cc-gardener/application_credential_id"
  applicationCredentialSecret: "vault+kvv2:///secrets/{{ $regionName }}/cc-gardener/application_credential_secret"
{{- end }}
---
# remove when safe. ref https://gardener.cloud/docs/gardener/shoot-operations/secretbinding-to-credentialsbinding-migration/
apiVersion: core.gardener.cloud/v1beta1
kind: SecretBinding
metadata:
  name: openstack-{{ $regionName }}
provider:
  type: openstack
secretRef:
  name: openstack-{{ $regionName }}
---
apiVersion: security.gardener.cloud/v1alpha1
kind: CredentialsBinding
metadata:
  name: openstack-{{ $regionName }}
provider:
  type: openstack
credentialsRef:
  apiVersion: v1
  kind: Secret
  name: openstack-{{ $regionName }}
  namespace: {{ $.Release.Namespace }}
---
apiVersion: v1
kind: Secret
metadata:
  name: metal-{{ $regionName }}
  annotations:
    metal.ironcore.dev/autoprovision: m-{{ coalesce $.Values.contextSuffix $region }}/metal-servers
type: Opaque
---
# remove when safe. ref https://gardener.cloud/docs/gardener/shoot-operations/secretbinding-to-credentialsbinding-migration/
apiVersion: core.gardener.cloud/v1beta1
kind: SecretBinding
metadata:
  name: metal-{{ $regionName }}
provider:
  type: ironcore-metal
secretRef:
  name: metal-{{ $regionName }}
---
apiVersion: security.gardener.cloud/v1alpha1
kind: CredentialsBinding
metadata:
  name: metal-{{ $regionName }}
provider:
  type: ironcore-metal
credentialsRef:
  apiVersion: v1
  kind: Secret
  name: metal-{{ $regionName }}
  namespace: {{ $.Release.Namespace }}
{{- end }}
