{{ if .Values.kvmShoots -}}
{{- range $key, $cluster := .Values.kvmShoots }}
apiVersion: core.gardener.cloud/v1beta1
kind: Shoot
metadata:
  name: {{ $key }}
  namespace: garden-ccloud
spec:
  cloudProfileName: metal
  secretBindingName: metal-{{ .Values.global.region }}
  region: {{ required "missing .Values.global.region" .Values.global.region }}
  networking:
    pods: {{ $cluster.networking.pods }}
    services: {{ $cluster.networking.services }}
    nodes: {{ $cluster.networking.nodes }}
    type: calico
    providerConfig:
      apiVersion: calico.networking.extensions.gardener.cloud/v1alpha1
      kind: NetworkConfig
      overlay:
        enabled: false
  kubernetes:
    version: {{ $cluster.version }}
    kubeAPIServer:
      enableAnonymousAuthentication: true # cluster registry version check
      oidcConfig: {{- toYaml .Values.oidcConfig | nindent 8 }}
  maintenance:
    autoUpdate:
      kubernetesVersion: false
      machineImageVersion: false
  provider:
    type: metal
    infrastructureConfig:
      apiVersion: metal.provider.extensions.gardener.cloud/v1alpha1
      kind: InfrastructureConfig
{{- toYaml $ $cluster.infrastructureConfig | nindent 8 }}
    controlPlaneConfig:
      apiVersion: metal.provider.extensions.gardener.cloud/v1alpha1
      kind: ControlPlaneConfig
{{- toYaml $ $cluster.controlPlaneConfig | nindent 8 }}
    workers:
{{- range $worker := $cluster.workers }}
    {{- toYaml $worker | nindent 6 }}
{{- end }}
{{- end }}
{{- end }}
