{
  "kind": "Dashboard",
  "metadata": {
    "name": "plugins",
    "createdAt": "2026-01-15T13:50:57.504980036Z",
    "updatedAt": "2026-01-15T14:15:05.210354381Z",
    "version": 2,
    "project": "greenhouse"
  },
  "spec": {
    "display": {
      "name": "Plugins"
    },
    "panels": {
      "245af47f86284426baadfdf2ef36319b": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Plugin Workload 'Not Ready' for over 15 minutes",
            "description": "GreenhousePluginWorkloadNotReady: The workload for plugin in organization on cluster as not been ready for more than 15 minutes."
          },
          "plugin": {
            "kind": "StatChart",
            "spec": {
              "calculation": "last-number",
              "format": {
                "decimalPlaces": 0,
                "shortValues": false,
                "unit": "decimal"
              },
              "mappings": [
                {
                  "kind": "Value",
                  "spec": {
                    "result": {
                      "color": "#2FBF71",
                      "value": "OK"
                    },
                    "value": "0"
                  }
                },
                {
                  "kind": "Range",
                  "spec": {
                    "from": 1,
                    "result": {
                      "color": "#EA4747",
                      "value": ""
                    }
                  }
                }
              ],
              "sparkline": {},
              "thresholds": {
                "steps": []
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "greenhouse_plugin_workload_status_up{cluster=~\"$clusterName\", owned_by=~\"$ownedBy\"}",
                    "seriesNameFormat": "{{cluster}} | {{namespace}} | {{owned_by}} | {{plugin}}"
                  }
                }
              }
            }
          ]
        }
      },
      "508ee3b054314c37bf1a47175d56db05": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Installed plugins"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "cellSettings": [
                {
                  "backgroundColor": "#EA4747",
                  "condition": {
                    "kind": "Value",
                    "spec": {
                      "value": "0"
                    }
                  },
                  "text": "Not Installed",
                  "textColor": "#ffffff"
                },
                {
                  "backgroundColor": "#2FBF71",
                  "condition": {
                    "kind": "Regex",
                    "spec": {
                      "expr": "[1-9]+"
                    }
                  },
                  "text": "",
                  "textColor": "#ffffff"
                }
              ],
              "columnSettings": [
                {
                  "enableSorting": true,
                  "name": "pluginDefinition",
                  "sort": "asc"
                },
                {
                  "enableSorting": true,
                  "header": "Status",
                  "name": "value",
                  "sort": "desc"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                }
              ],
              "density": "standard"
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum by(pluginDefinition) (greenhouse_plugin_ready{owned_by=~\"$ownedBy\", clusterName=~\"$clusterName\"})",
                    "seriesNameFormat": "{{pluginDefinition}}"
                  }
                }
              }
            }
          ]
        }
      },
      "512963ee1ff74a6e89049227f84b17ed": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Plugin Reconciliation is Constantly Failing",
            "description": "GreenhousePluginConstantlyFailing: Plugin in organization keeps failing with reason"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "columnSettings": [
                {
                  "hide": false,
                  "name": "clusterName",
                  "width": 100
                },
                {
                  "enableSorting": true,
                  "name": "namespace",
                  "sort": "asc",
                  "width": 100
                },
                {
                  "enableSorting": true,
                  "name": "plugin",
                  "sort": "asc",
                  "width": 300
                },
                {
                  "enableSorting": true,
                  "name": "reason",
                  "sort": "asc"
                },
                {
                  "align": "right",
                  "format": {
                    "decimalPlaces": 0,
                    "unit": "decimal"
                  },
                  "header": "count",
                  "name": "value"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                }
              ],
              "density": "standard"
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum by (namespace, plugin, reason, clusterName) (increase(greenhouse_plugin_reconcile_total{clusterName=~\"$clusterName\",result=\"error\"}[5m])) > 0",
                    "seriesNameFormat": ""
                  }
                }
              }
            }
          ]
        }
      },
      "5373979b5e794330b36719453d766e2c": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Number of reconciliations by Plugin"
          },
          "plugin": {
            "kind": "StatChart",
            "spec": {
              "calculation": "last-number",
              "format": {
                "unit": "decimal"
              },
              "sparkline": {},
              "thresholds": {
                "defaultColor": "#2FBF71",
                "steps": [
                  {
                    "color": "#FFCC00",
                    "value": 0
                  },
                  {
                    "color": "#FF9F1C",
                    "value": 5
                  },
                  {
                    "color": "#EA4747",
                    "value": 10
                  }
                ]
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "$step",
                    "query": "sum by(pluginDefinition)(greenhouse_plugin_reconcile_total{owned_by=~\"$ownedBy\",clusterName=~\"$clusterName\"})",
                    "seriesNameFormat": "{{pluginDefinition}}"
                  }
                }
              }
            }
          ]
        }
      },
      "70671561f36d4ce8a6085f2230515e63": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Installed plugins"
          },
          "plugin": {
            "kind": "StatChart",
            "spec": {
              "calculation": "last-number",
              "format": {
                "unit": "decimal"
              },
              "sparkline": {},
              "thresholds": {
                "defaultColor": "#EA4747",
                "steps": [
                  {
                    "color": "#FF9F1C",
                    "value": 0.5
                  },
                  {
                    "color": "#FFCC00",
                    "value": 0.8
                  },
                  {
                    "color": "#2FBF71",
                    "value": 1
                  }
                ]
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "label_replace(avg by (clusterName)(greenhouse_plugin_ready{pluginDefinition=~\"$pluginDefinition\"}), \"clusterName\", \"missingName\", \"clusterName\", \"\")",
                    "seriesNameFormat": "{{clusterName}}"
                  }
                }
              }
            }
          ]
        }
      },
      "79c6158acb8c40c59d79711233c531f2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Helm Chart Test Failing by Plugin ",
            "description": "GreenhousePluginHelmChartTestFailures: Helm Chart test for plugin in organization on cluster has been failing for the last 30 minutes"
          },
          "plugin": {
            "kind": "StatChart",
            "spec": {
              "calculation": "last-number",
              "format": {
                "decimalPlaces": 0,
                "shortValues": false,
                "unit": "decimal"
              },
              "mappings": [
                {
                  "kind": "Value",
                  "spec": {
                    "result": {
                      "color": "#2FBF71",
                      "value": "OK"
                    },
                    "value": "0"
                  }
                },
                {
                  "kind": "Range",
                  "spec": {
                    "from": 1,
                    "result": {
                      "color": "#EA4747",
                      "value": ""
                    }
                  }
                }
              ],
              "sparkline": {},
              "thresholds": {
                "steps": []
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum by(plugin, cluster, namespace)(rate(greenhouse_plugin_chart_test_runs_total{cluster=~\"$clusterName\", owned_by=~\"$ownedBy\", result=\"Error\"}[15m])) > 0",
                    "seriesNameFormat": "{{cluster}} | {{namespace}} | {{owned_by}} | {{plugin}}"
                  }
                }
              }
            }
          ]
        }
      },
      "99f96c3238b1405b9b12be3570cce66d": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Plugins"
          },
          "plugin": {
            "kind": "StatusHistoryChart",
            "spec": {
              "mappings": [
                {
                  "kind": "Value",
                  "spec": {
                    "result": {
                      "color": "#EA4747",
                      "value": ""
                    },
                    "value": "0"
                  }
                },
                {
                  "kind": "Value",
                  "spec": {
                    "result": {
                      "color": "#2FBF71",
                      "value": ""
                    },
                    "value": "1"
                  }
                }
              ]
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "$step",
                    "query": "sum (avg_over_time(greenhouse_plugin_ready{owned_by=~\"$ownedBy\", clusterName=~\"$clusterName\"}[5m])) by (pluginDefinition)",
                    "seriesNameFormat": "{{pluginDefinition}}"
                  }
                }
              }
            }
          ]
        }
      },
      "b29a2dd4570147f1bee21b48da7ca010": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Plugins 'Not Ready' for over 15 minutes",
            "description": "GreenhousePluginNotReady: The plugin in organization on cluster has not been ready for more than 15 minutes."
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "cellSettings": [
                {
                  "backgroundColor": "#ff5050",
                  "condition": {
                    "kind": "Value",
                    "spec": {
                      "value": "0"
                    }
                  },
                  "text": "Not Ready",
                  "textColor": "#ffffff"
                }
              ],
              "columnSettings": [
                {
                  "enableSorting": true,
                  "name": "clusterName",
                  "sort": "asc"
                },
                {
                  "name": "pluginDefinition"
                },
                {
                  "enableSorting": false,
                  "header": "Status",
                  "name": "value",
                  "width": 50
                },
                {
                  "hide": true,
                  "name": "timestamp"
                }
              ],
              "density": "standard"
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum by(clusterName, pluginDefinition) (greenhouse_plugin_ready{clusterName=~\"$clusterName\"}==0)",
                    "seriesNameFormat": "{{clusterName}} | {{pluginDefinition}}"
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Plugin overview",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 24,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/70671561f36d4ce8a6085f2230515e63"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Alerts",
            "collapse": {
              "open": false
            }
          },
          "items": [
            {
              "x": 0,
              "y": 12,
              "width": 5,
              "height": 12,
              "content": {
                "$ref": "#/spec/panels/b29a2dd4570147f1bee21b48da7ca010"
              }
            },
            {
              "x": 14,
              "y": 0,
              "width": 5,
              "height": 12,
              "content": {
                "$ref": "#/spec/panels/79c6158acb8c40c59d79711233c531f2"
              }
            },
            {
              "x": 0,
              "y": 0,
              "width": 14,
              "height": 12,
              "content": {
                "$ref": "#/spec/panels/512963ee1ff74a6e89049227f84b17ed"
              }
            },
            {
              "x": 5,
              "y": 12,
              "width": 5,
              "height": 12,
              "content": {
                "$ref": "#/spec/panels/245af47f86284426baadfdf2ef36319b"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Panel Group - $clusterName",
            "collapse": {
              "open": false
            }
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 12,
              "content": {
                "$ref": "#/spec/panels/508ee3b054314c37bf1a47175d56db05"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 12,
              "height": 6,
              "content": {
                "$ref": "#/spec/panels/5373979b5e794330b36719453d766e2c"
              }
            },
            {
              "x": 12,
              "y": 6,
              "width": 12,
              "height": 6,
              "content": {
                "$ref": "#/spec/panels/99f96c3238b1405b9b12be3570cce66d"
              }
            }
          ],
          "repeatVariable": "clusterName"
        }
      }
    ],
    "variables": [
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "Owner",
            "hidden": false
          },
          "defaultValue": [
            "compute",
            "observability"
          ],
          "allowAllValue": true,
          "allowMultiple": true,
          "sort": "alphabetical-asc",
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "labelName": "owned_by",
              "matchers": [
                "greenhouse_plugin_ready"
              ]
            }
          },
          "name": "ownedBy"
        }
      },
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "Cluster name",
            "hidden": false
          },
          "defaultValue": "$__all",
          "allowAllValue": true,
          "allowMultiple": true,
          "sort": "alphabetical-asc",
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "labelName": "clusterName"
            }
          },
          "name": "clusterName"
        }
      },
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "Step size",
            "hidden": false
          },
          "defaultValue": "5m",
          "allowAllValue": false,
          "allowMultiple": false,
          "plugin": {
            "kind": "StaticListVariable",
            "spec": {
              "values": [
                {
                  "label": "1m",
                  "value": "1m"
                },
                {
                  "label": "2m",
                  "value": "2m"
                },
                {
                  "label": "5m",
                  "value": "5m"
                },
                {
                  "label": "10m",
                  "value": "10m"
                },
                {
                  "label": "15m",
                  "value": "15m"
                },
                {
                  "label": "30m",
                  "value": "30m"
                },
                {
                  "label": "1h",
                  "value": "1h"
                },
                {
                  "label": "6h",
                  "value": "6h"
                },
                {
                  "label": "12h",
                  "value": "12h"
                },
                {
                  "label": "24h",
                  "value": "24h"
                }
              ]
            }
          },
          "name": "step"
        }
      },
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "PluginDefinition",
            "hidden": false
          },
          "defaultValue": "ingress-nginx",
          "allowAllValue": false,
          "allowMultiple": false,
          "sort": "alphabetical-asc",
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "labelName": "pluginDefinition",
              "matchers": [
                "greenhouse_plugin_ready"
              ]
            }
          },
          "name": "pluginDefinition"
        }
      }
    ],
    "duration": "1h",
    "refreshInterval": "0s"
  }
}
