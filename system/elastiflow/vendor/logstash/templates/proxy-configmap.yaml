{{ if .Values.enable_proxy}}
kind: ConfigMap
apiVersion: v1
metadata:
  name: elastiflow-nginx-config
  labels:
    app: "{{ template "logstash.fullname" . }}-proxy"
    chart: "{{ .Chart.Name }}"
    heritage: {{ .Release.Service | quote }}
    release: {{ .Release.Name | quote }}
data:
  nginx.conf: |
    pid  /tmp/nginx.pid;
    user nginx;
    worker_processes  5;
    error_log  /dev/stdout info;
    events {
      worker_connections  10240;
    }

    stream {

      upstream logstash_upstream {
        server netflow-logstash-0.elastiflow-logstash-svc:5044;
        server netflow-logstash-1.elastiflow-logstash-svc:5044;
      }
      server {
          listen 5044;
          proxy_pass logstash_upstream;
      }
    }
{{- end }}
