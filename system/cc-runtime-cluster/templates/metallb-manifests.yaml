apiVersion: v1
kind: ConfigMap
metadata:
  name: metallb-manifests
data:
  data: |-
    apiVersion: metallb.io/v1beta1
    kind: L2Advertisement
    metadata:
      name: l2adv
      namespace: metallb-system
{{- if .Values.metallb }}
    ---
    apiVersion: metallb.io/v1beta1
    kind: IPAddressPool
    metadata:
      name: metallb-pool
      namespace: metallb-system
    spec:
      addresses:
    {{- toYaml .Values.metallb.l2pools.addresses | nindent 6 }}
    ---
    apiVersion: metallb.io/v1beta1
    kind: IPAddressPool
    metadata:
      name: metallb-pool-manual
      namespace: metallb-system
    spec:
      addresses:
    {{- toYaml .Values.metallb.l2poolsManual.addresses | nindent 6 }}
      autoAssign: false
{{ end}}
