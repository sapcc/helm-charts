apiVersion: batch/v1
kind: CronJob
metadata:
  name: cronjob-availability
  namespace: jupyterhub
spec:
  schedule: "0 1 4 * * "
  jobTemplate:
    spec:
      backoffLimit: 2
      activeDeadlineSeconds: 1800
      template:
        spec:
          volumes:
            - name: jupyterhub-secrets
              secret:
                secretName: jupyterhub-secrets
          containers:
          - name: jupyterhub-api-availability
            image: "{{ required ".Values.global.registry variable missing" .Values.global.registry }}/{{ .Values.jupyterhub_cron.image }}:{{ .Values.jupyterhub_cron.imageTag }}"
              - name: jupyterhub-secrets
                mountPath: /jupyterhub/secrets
                readOnly: true
          restartPolicy: Never