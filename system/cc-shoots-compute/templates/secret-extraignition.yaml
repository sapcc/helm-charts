{{- range $key, $cluster := .Values.kvmShoots }}
---
apiVersion: v1
kind: Secret
metadata:
  name: extraignition-compute-{{ $key }}
type: Opaque
stringData:
  ignition: |
    passwd:
      users:
        - name: "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-user/username` }}" $cluster.region }}"
          password_hash: "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-user/passwordHash` }}" $cluster.region }}"
          groups: [ "wheel" ]
          ssh_authorized_keys:
            - "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-pki/public` }}" $cluster.region }}"
            {{- if contains "qa" $.Values.global.region }}
            - "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/kvm-ha/hatest-ssh-user/public` }}" $cluster.region }}"
            {{- end }}
    storage:
      files:
{{ $.Values.extraIgnition.commonFiles | indent 8 }}
{{- end }}
