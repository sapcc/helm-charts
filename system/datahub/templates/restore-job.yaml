{{- if .Values.mariadb.restore.enabled }}
apiVersion: batch/v1beta1
kind: CronJob
metadata: 
  name: datahubdb-restore
  namespace: datahub
  labels:
    app.kubernetes.io/name: datahubdb-restore
    helm.sh/chart: {{ include "datahub.chart" $ }}
    app.kubernetes.io/instance: datahubdb-restore-{{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
spec:
  schedule: "{{ .Values.mariadb.restore.schedule }}"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: datahubdb-restore
            image: "{{ .Values.mariadb.restore.image.repo }}:{{ .Values.mariadb.restore.image.tag }}"
            volumeMounts:
            - name: restore-config
              mountPath: /config
          restartPolicy: OnFailure
          volumes:
          - name: restore-config
            configMap:
              name: datahubdb-restore-config
{{- end }}