{{- $regions := list -}}
{{- range $key, $cluster := .Values.stShoots -}}
  {{- $region := regexReplaceAll "^st[0-9]+-" $key "" }}
  {{- $regions = append $regions $region -}}
{{- end -}}
{{- $uniqueRegions := $regions | uniq | sortAlpha -}}
{{- range $uniqueRegions }}
{{- if and (ne $.Release.Namespace "garden") (ne $.Release.Namespace "garden-ccloud") }}
---
apiVersion: v1
kind: Secret
metadata:
  name: metal-{{ . }}
  annotations:
    metal.ironcore.dev/autoprovision: m-{{ coalesce $.Values.contextSuffix . }}/metal-servers
type: Opaque
---
apiVersion: security.gardener.cloud/v1alpha1
kind: CredentialsBinding
metadata:
  name: metal-{{ . }}
provider:
  type: ironcore-metal
credentialsRef:
  apiVersion: v1
  kind: Secret
  name: metal-{{ . }}
  namespace: {{ $.Release.Namespace }}
{{- end }}
{{- end }}
