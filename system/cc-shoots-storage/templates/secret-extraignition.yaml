{{- range $key, $cluster := .Values.stShoots }}
{{- $region := regexReplaceAll "^st[0-9]+-" $key "" }}
---
apiVersion: v1
kind: Secret
metadata:
  name: extraignition-storage-{{ $key }}
type: Opaque
stringData:
  ignition: |
    passwd:
      users:
        - name: "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-user/username` }}" $region }}"
          password_hash: "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-user/passwordHash` }}" $region }}"
          groups: [ "wheel" ]
          ssh_authorized_keys:
            - "{{ printf "{{ resolve `vault+kvv2:///secrets/%s/cc-gardener/nodes/compute-pki/public` }}" $region }}"
{{- end }}
