{{ $chartName := .Chart.Name }}
{{ range $roleBinding := .Values.teamRoleBindings }}
{{- if and $roleBinding.teamRef $roleBinding.teamRoleRef $roleBinding.clusterSelector }}
---
apiVersion: greenhouse.sap/v1alpha1
kind: TeamRoleBinding
metadata:
  name: {{ printf "%s-%s-%s" $roleBinding.teamRef $roleBinding.teamRoleRef | trunc 63 | trimSuffix "-" }}
  namespace: {{ $chartName }}
spec:
  teamRef: {{ $roleBinding.teamRef }}
  teamRoleRef: {{ $roleBinding.teamRoleRef }}
  clusterSelector:
    {{- $roleBinding.clusterSelector | toYaml | nindent 4 }}
{{- end }}
{{- else }}
{{- printf "Error: Missing teamRef, teamRoleRef, or clusterName in teamRoleBinding: %#v" $roleBinding | fail }}
{{- end }}
