{{- $dnsRegion := "" }}
{{- if .Values.garden.dns }}
{{- $dnsRegion = (default .Values.global.region .Values.garden.dns.region) }}
{{- else }}
{{- $dnsRegion = .Values.global.region }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: default-domain-external-openstack-gardener-cloud
  namespace: garden
  labels:
    app: gardener
    gardener.cloud/role: default-domain
  annotations:
    dns.gardener.cloud/provider: openstack-designate
    dns.gardener.cloud/domain: external.{{ required ".Values.global.cluster missing" .Values.global.cluster }}.{{ if hasPrefix "rtc-" .Values.global.cluster -}}soil-customer{{- else -}}soil-garden{{- end }}.{{ $dnsRegion }}.cloud.sap
type: Opaque
stringData:
  OS_DOMAIN_NAME: ccadmin
  OS_AUTH_URL: https://identity-3.{{ required ".Values.global.region missing" .Values.global.region }}.cloud.sap/v3
{{- if and .Values.gardenlet.applicationCredentialIDOverride .Values.gardenlet.applicationCredentialSecretOverride }}
  OS_PROJECT_NAME: gardener-customer
  OS_APPLICATION_CREDENTIAL_ID: {{ .Values.gardenlet.applicationCredentialIDOverride }}
  OS_APPLICATION_CREDENTIAL_SECRET: {{ .Values.gardenlet.applicationCredentialSecretOverride }}
{{- else }}
  OS_PROJECT_NAME: cc-gardener
  OS_APPLICATION_CREDENTIAL_ID: "vault+kvv2:///secrets/{{ required ".Values.global.region missing" .Values.global.region }}/cc-gardener/application_credential_id"
  OS_APPLICATION_CREDENTIAL_SECRET: "vault+kvv2:///secrets/{{ required ".Values.global.region missing" .Values.global.region }}/cc-gardener/application_credential_secret"
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: internal-domain-internal-openstack-gardener-cloud
  namespace: garden
  labels:
    app: gardener
    gardener.cloud/role: internal-domain
  annotations:
    dns.gardener.cloud/provider: openstack-designate
    dns.gardener.cloud/domain: internal.{{ required ".Values.global.cluster missing" .Values.global.cluster }}.{{ if hasPrefix "rtc-" .Values.global.cluster -}}soil-customer{{- else -}}soil-garden{{- end }}.{{ $dnsRegion }}.cloud.sap
type: Opaque
stringData:
  OS_DOMAIN_NAME: ccadmin
  OS_AUTH_URL: https://identity-3.{{ required ".Values.global.region missing" .Values.global.region }}.cloud.sap/v3
{{- if and .Values.gardenlet.applicationCredentialIDOverride .Values.gardenlet.applicationCredentialSecretOverride }}
  OS_PROJECT_NAME: gardener-customer
  OS_APPLICATION_CREDENTIAL_ID: {{ .Values.gardenlet.applicationCredentialIDOverride }}
  OS_APPLICATION_CREDENTIAL_SECRET: {{ .Values.gardenlet.applicationCredentialSecretOverride }}
{{- else }}
  OS_PROJECT_NAME: cc-gardener
  OS_APPLICATION_CREDENTIAL_ID: "vault+kvv2:///secrets/{{ required ".Values.global.region missing" .Values.global.region }}/cc-gardener/application_credential_id"
  OS_APPLICATION_CREDENTIAL_SECRET: "vault+kvv2:///secrets/{{ required ".Values.global.region missing" .Values.global.region }}/cc-gardener/application_credential_secret"
{{- end }}
---
# name depends on gardenlet values (seedConfig.spec.dns.provider.secretRef)
apiVersion: v1
kind: Secret
metadata:
  name: openstack-{{ .Values.global.region }}
  namespace: garden
  labels:
    app: gardener
type: Opaque
stringData:
  domainName: ccadmin
  authURL: https://identity-3.{{ .Values.global.region }}.cloud.sap/v3
{{- if and .Values.gardenlet.applicationCredentialIDOverride .Values.gardenlet.applicationCredentialSecretOverride }}
  tenantName: gardener-customer
  applicationCredentialID: {{ .Values.gardenlet.applicationCredentialIDOverride }}
  applicationCredentialSecret: {{ .Values.gardenlet.applicationCredentialSecretOverride }}
  # requried for the backup to work appearently
  applicationCredentialName: {{ .Values.gardenlet.applicationCredentialNameOverride }}
{{- else }}
  tenantName: cc-gardener
  applicationCredentialID: "vault+kvv2:///secrets/{{ .Values.global.region }}/cc-gardener/application_credential_id"
  applicationCredentialSecret: "vault+kvv2:///secrets/{{ .Values.global.region }}/cc-gardener/application_credential_secret"
  # requried for the backup to work appearently
  applicationCredentialName: cc-gardener
{{- end }}
{{- range $region := .Values.gardenlet.additionalSeedRegions }}
---
# name depends on gardenlet values (seedConfig.spec.dns.provider.secretRef)
apiVersion: v1
kind: Secret
metadata:
  name: openstack-{{ $region.name }}
  namespace: garden
  labels:
    app: gardener
type: Opaque
stringData:
  domainName: ccadmin
  authURL: https://identity-3.{{ $region.name }}.cloud.sap/v3
{{- if and $.Values.gardenlet.applicationCredentialIDOverride $.Values.gardenlet.applicationCredentialSecretOverride }}
  tenantName: gardener-customer
  applicationCredentialID: {{ $.Values.gardenlet.applicationCredentialIDOverride }}
  applicationCredentialSecret: {{ $.Values.gardenlet.applicationCredentialSecretOverride }}
  # requried for the backup to work appearently
  applicationCredentialName: {{ $.Values.gardenlet.applicationCredentialNameOverride }}
{{- else }}
  tenantName: cc-gardener
  applicationCredentialID: "vault+kvv2:///secrets/{{ $region.name }}/cc-gardener/application_credential_id"
  applicationCredentialSecret: "vault+kvv2:///secrets/{{ $region.name }}/cc-gardener/application_credential_secret"
  # requried for the backup to work appearently
  applicationCredentialName: cc-gardener
{{- end }}
{{- end }}
