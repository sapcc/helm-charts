{{ if .Values.extensions.metal.enabled -}}
---
apiVersion: cloudprofilesync.cobaltcore.dev/v1alpha1
kind: ManagedCloudProfile
metadata:
  name: ironcore-metal
spec:
  cloudProfile:
    type: ironcore-metal
    seedSelector:
      providerTypes: ["*"]
    regions: {{ toYaml .Values.extensions.metal.regions | nindent 4 }}
    kubernetes:
      versions: {{ toYaml .Values.extensions.kubernetesVersions | nindent 6 }}
    machineTypes: {{ toYaml .Values.extensions.metal.machineTypes | nindent 4 }}
    {{- if .Values.extensions.metal.machineImages }}
    machineImages: {{ toYaml .Values.extensions.metal.machineImages | nindent 4 }}
    {{- end }}
    providerConfig: # https://github.com/ironcore-dev/gardener-extension-provider-metal/blob/main/pkg/apis/metal/v1alpha1/types_cloudprofile.go
      apiVersion: ironcore-metal.provider.extensions.gardener.cloud/v1alpha1
      kind: CloudProfileConfig
      {{ if .Values.extensions.metal.providerConfig.regionConfigs }}
      regionConfigs: {{ toYaml .Values.extensions.metal.providerConfig.regionConfigs | nindent 6 }}
      {{- end }}
      {{ if .Values.extensions.metal.providerConfig.machineTypes }}
      machineTypes: {{ toYaml .Values.extensions.metal.providerConfig.machineTypes | nindent 6 }}
      {{- end }}
      {{- if .Values.extensions.metal.providerConfig.machineImages }}
      machineImages: {{ toYaml .Values.extensions.metal.providerConfig.machineImages | nindent 6 }}
      {{- end }}
  {{- if .Values.extensions.metal.machineImageUpdates }}
  machineImageUpdates: {{ toYaml .Values.extensions.metal.machineImageUpdates | nindent 4 }}
  {{- end }}
{{- end }}
