{{- if .Values.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "correlator.fullname" . }}-config
  labels:
    {{- include "correlator.labels" . | nindent 4 }}
data:
  env.yml: |-
    # the id of the aci to query keys from the cache for
    aci_id: {{ .Values.env.aci_id | quote }}

    apic_host: {{ required "missing $.Values.aci.apic_hosts" $.Values.aci.apic_hosts | quote }}

    # cache connection (password from env)
    cache_host: {{ .Values.env.cache_host | quote }}
    cache_port: {{ .Values.env.cache_port | int }}
    cache_timeout: {{ .Values.env.cache_timeout | int }}
    cache_max_delay: {{ .Values.env.cache_max_delay | int }}
    cache_max_retries: {{ .Values.env.cache_max_retries | int }}

    metrics_port: {{ .Values.env.metrics_port | int }}

    enricher:
{{- toYaml .Values.env.enricher | nindent 6 }}

    correlator:
{{- toYaml .Values.env.correlator | nindent 6 }}

    actions:
{{- toYaml .Values.env.actions | nindent 6 }}

    log_level: {{ .Values.env.log_level | quote }}
{{- end }}
