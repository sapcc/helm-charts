fullname: aci-correlator
enabled: true

replicaCount: 1

image:
  name: aci-correlator
  tag: "1.7.0"
  pullPolicy: Always

resources:
  requests:
    cpu: "200m"
    memory: "512Mi"
  limits:
    cpu: "1"
    memory: "2Gi"

service:
  type: LoadBalancer
  port: 11003

env:
  aci_id: "mock"

  # cache connection (host/port only; password from per-chart Secret)
  cache_host: "aci-cache-valkey"
  cache_port: 6379
  cache_timeout: 3
  cache_max_delay: 1
  cache_max_retries: 5

  metrics_port: 11003

  enricher:
    global_regex:
      dn: (.*?)(?:\/fault.*)?$
      psu_slot: /psuslot-(?P<psu_slot>\d+)
      frozen_eps: ^(?P<frozen_eps>\d+)\sEP
      node_id: /node-(?P<node_id>\d+)/
      node_intf: /(phys|if)-\[(?P<node_intf>[^\]]+)\]/
      node_pod: /pod-(?P<node_pod>\d+)/
      node_po: /(aggr|if)-\[(?P<node_po>[po\d]+)]
      node_vpc_id: /node-\d+/sys/vpc/.+/if-(\d+)/
      node_vpc_name: (?:stpathatt-\[|accbundle-)([^\]/]+)
      bgp_peer_ip: /bgp/.+?/peer-\[(?P<bgp_peer_ip>[\d\.]+)/32]/
      vrf_name: /dom-[^:]+:(?P<vrf_name>[^/]+)

  correlator:
    F0299:
      default_severity: "5"
      search:
        F0532:
          severity: "2"
          equals: ["node_id", "node_intf"]
        F1296:
          severity: "2"
          equals: ["node_id", "node_intf"]
    F1296:
      default_severity: "5"
      search:
        F0532:
          severity: "2"
          equals: ["node_id", "node_intf"]

  actions:
    F0299:
      action: collect_more_data_for_bgp
      automation: "0"
      automation_args:
        node_id: node_id
        peer_ip: bgp_peer_ip
      matchers:
        correlated: ["==", "0"]
        created: [">", "1d"]
        device_name: ["NotEmpty"]

  # settings for REST-API
  api_host: "0.0.0.0"
  api_port: 8080
  api_debug: false

  # settings for metric expiration on the automation result
  automation_result_expiry_days: 30

  log_level: "INFO"

aci:
  aci_user:
  aci_password:
  apic_hosts:
  cache_password:
